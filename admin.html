<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Адмін-панель | OluxGameStore</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-wrap { padding: 50px; max-width: 1200px; margin: 0 auto; }
        .admin-card { background: white; padding: 30px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); }
        .order-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .order-table th, .order-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; color: #333; }
        .order-table th { color: #888; font-size: 14px; text-transform: uppercase; }
        .price-tag { color: #d4af37; font-weight: bold; }
        .back-btn { background: #4a3427; color: white; padding: 10px 20px; border-radius: 12px; text-decoration: none; display: inline-block; margin-bottom: 20px; font-weight: bold; }
    </style>
</head>
<body style="background: #f7f3ed;">

    <div class="admin-wrap">
        <a href="index.html" class="back-btn">← Повернутися в магазин</a>
        
        <div class="admin-card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>Панель керування замовленнями</h2>
                <button onclick="loadOrders()" style="cursor:pointer; padding: 8px 15px; border-radius: 10px; border: 1px solid #ddd;">Оновити дані</button>
            </div>
            
            <table class="order-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Користувач (Email)</th>
                        <th>Товари</th>
                        <th>Сума</th>
                        <th>Дата</th>
                    </tr>
                </thead>
                <tbody id="admin-list">
                    </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SB_URL = 'https://yoxieszknznklpvnyvui.supabase.co';
        const SB_KEY = 'sb_publishable_ZLbve8ADHIqc48h2YOQQUw_z8vox0s9';
        const sb = supabase.createClient(SB_URL, SB_KEY);

        async function loadOrders() {
            const list = document.getElementById('admin-list');
            list.innerHTML = '<tr><td colspan="5">Завантаження...</td></tr>';

            const { data, error } = await sb
                .from('orders')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                list.innerHTML = '<tr><td colspan="5" style="color:red;">Помилка: ' + error.message + '</td></tr>';
                return;
            }

            if (data.length === 0) {
                list.innerHTML = '<tr><td colspan="5">Замовлень поки немає.</td></tr>';
                return;
            }

            list.innerHTML = data.map(o => `
                <tr>
                    <td style="font-family: monospace; font-size: 12px; color: #999;">#${o.id.slice(0,8)}</td>
                    <td><b>${o.user_email}</b></td>
                    <td>${o.items_names}</td>
                    <td><span class="price-tag">${o.total_price} грн</span></td>
                    <td>${new Date(o.created_at).toLocaleString('uk-UA')}</td>
                </tr>
            `).join('');
        }

        window.onload = loadOrders;
    </script>
</body>
</html>
